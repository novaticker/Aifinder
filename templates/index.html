<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI ê¸‰ë“±ì£¼ íƒìƒ‰ê¸°</title>
  <style>
    body { font-family: sans-serif; background: #f5f6fa; margin: 0; padding: 20px; text-align: center; }
    .card { background: white; border-radius: 10px; padding: 15px; margin: 10px auto; width: 90%; max-width: 500px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: left; }
    .symbol { font-weight: bold; font-size: 18px; color: #2c3e50; }
    .summary { margin-top: 5px; color: #34495e; }
    .info { font-size: 13px; color: gray; }
    .delete-btn { float: right; cursor: pointer; }
    .refresh-btn { margin: 20px auto; padding: 10px 20px; background: #2ecc71; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>
  <h2>ğŸ¤– AI ê¸‰ë“±ì£¼ íƒìƒ‰ê¸°</h2>
  <button class="refresh-btn" onclick="refreshData()">ğŸ”„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨</button>
  <div id="gainer-list"></div>

  <script>
    async function loadData() {
      const res = await fetch('/data.json');
      const data = await res.json();
      const today = new Date().toISOString().slice(0, 10);
      const list = document.getElementById('gainer-list');
      list.innerHTML = '';

      if (!data[today] || !data[today].gainers || data[today].gainers.length === 0) {
        list.innerHTML = '<p>ğŸ“Œ ì˜¤ëŠ˜ì˜ ê¸‰ë“± ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }

      data[today].gainers.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="symbol">ğŸ§¾ ${item.symbol}
            <span class="delete-btn" onclick="deleteItem('${item.symbol}', '${item.time}', '${today}')">ğŸ—‘ï¸</span>
          </div>
          <div class="summary">ğŸ’¡ AI ë¶„ì„: ${item.summary || 'ì •ë³´ ì—†ìŒ'}</div>
          <div class="info">ğŸ•’ ${item.time || '-'} | ğŸ“° ${item.phase || '-'}</div>
        `;
        list.appendChild(card);
      });
    }

    async function refreshData() {
      await fetch('/update_news');
      loadData();
    }

    async function deleteItem(symbol, title, date) {
      const res = await fetch('/delete_news', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ symbol, title, date })
      });
      const result = await res.json();
      if (result.status === 'success') {
        alert('âœ… ì‚­ì œë¨');
        loadData();
      } else {
        alert('âŒ ì‚­ì œ ì‹¤íŒ¨');
      }
    }

    loadData();
  </script>
</body>
</html>
